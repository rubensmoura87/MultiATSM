# Paper Replications

This vignette leverages the *MultiATSM* package to reproduce some
empirical findings from three academic papers centered around the
unspanned macroeconomic risk framework. The first segment focuses on
replicating the outcomes of Joslin, Priebsch, and Singleton (2014),
which laid the foundation for the unspanned risk ATSM literature through
a single-country analysis of the U.S. economy. Subsequently, I present
the multi-country model extension proposed by Candelon and Moura (2024),
employing a GVAR approach to capture risk factor dynamics. Lastly, I
introduce the program designed to replicate results detailed in Candelon
and Moura (2023), an extension of the previous framework to investigate
the term structure behavior of major emerging markets during the
unprecedented COVID$- 19$ pandemic. It is worth highlighting that, due
to limited public availability of bond yield data, I employ, in certain
instances, simulated data closely matching the original papers’
construction method. Consequently, while the outputs generated by the
scripts below may not exactly mirror those from the original papers, the
main features of these results are preserved.

A thorough explanation on the usage of the additional functionalities of
the *MultiATSM* package are documented in the vignette **General
Guidelines**.

``` r
library(MultiATSM)
```

## Joslin, Priebsch and Singleton (2014)

The database used in this replication was constructed by Bauer and
Rudebusch (2017) (BR, 2017) and is available at [Bauer’s
website](https://www.michaeldbauer.com/publication/spanning-puzzle/). In
that paper, BR (2017) investigate whether macro-finance term structure
models better suit the unspanned macro risk framework by JPS (2014) or
the earlier traditional spanned settings as the one by Ang and Piazzesi
(2003). Accordingly, BR (2017) intend to replicate some of the empirical
results reported in JPS (2014). The R-code used by BR (2017) is also
available at [Bauer’s
website](https://www.michaeldbauer.com/publication/spanning-puzzle/).

Supported by BR (2017)’s data-set, the code below uses the *MultiATSM*
package to estimate the key model parameters from the ATSM along the
lines of JPS (2014). The model estimation is performed using the *JPS
original* modeling setup.

``` r
# A) Load database data
LoadData("BR_2017")

# B) GENERAL model inputs
ModelType <- "JPS original"

Economies <- c("US") # Names of the economies from the economic system
GlobalVar <- c() # Global Variables
DomVar <- c("GRO", "INF") # Country-specific variables
N <- 3 # Number of spanned factors per country

t0_sample <- "January-1985"
tF_sample <- "December-2007"

DataFreq <- "Monthly" # Frequency of the data

StatQ <- FALSE # Stationary condition

#########################################################################################################
############################### NO NEED TO MAKE CHANGES FROM HERE #######################################
#########################################################################################################
# 2) Minor preliminary work
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

Yields <- t(BR_jps_out$Y)
DomesticMacroVar <- t(BR_jps_out$M.o)
GlobalMacroVar <- c()

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(t0_sample, tF_sample, ModelType, Yields, GlobalMacroVar, DomesticMacroVar,
  FactorLabels, Economies, DataFreq,
  verbose = FALSE
)

# 4) Optimization of the model
ModelPara <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType,
  verbose = FALSE
)
```

The tables below compare the ATSM parameter estimates generated from BR
(2017) and the *MultiATSM*. Overall, one can note that the differences
in the estimates are economically modest.

|                                                                                                                                | MultiATSM | BR (2017) |
|:-------------------------------------------------------------------------------------------------------------------------------|:---------:|:---------:|
| $r0$                                                                                                                           |  0.00055  | -0.00016  |
| $\lambda_{1}$                                                                                                                  |  0.99670  |  0.99682  |
| $\lambda_{2}$                                                                                                                  |  0.91488  |  0.95945  |
| $\lambda_{3}$                                                                                                                  |  0.91488  |  0.87174  |
| Note:                                                                                                                          |           |           |
| $\lambda$’s are the eigenvalues from the risk-neutral feedback matrix and $r0$ is the long-run mean of the short rate under Q. |           |           |

$Q$-dynamics parameters

[TABLE]

$P$-dynamics parameters

|                                                                                 | MultiATSM | BR (2017) |
|:--------------------------------------------------------------------------------|:---------:|:---------:|
| se                                                                              | 0.0000546 | 0.000055  |
| Note:                                                                           |           |           |
| $se$ is the standard deviation of the portfolio of yields observed with errors. |           |           |

Portfolio of yields with errors

For replicability, it is important to note that the $P -$dynamics
results reported in [Table 1.2](#tab-PdynTab) for the *MultiATSM*
package make use of the principal component weights provided by BR
(2017). Such a matrix is simply a scaled-up version of the one provided
by the function
[`pca_weights_one_country()`](https://rubensmoura87.github.io/MultiATSM/reference/pca_weights_one_country.md)
of this package. Accordingly, despite the numerical differences on the
weight matrices, both methods generate time series of spanned factors
which are perfectly correlated. Another difference between the two
approaches relates to the construction form of the log-likelihood
function (llk): while in the BR (2017) code the llk is expressed in
terms of a portfolio of yields, the *MultiATSM* package generates this
same input directly as a function of observed yields (i.e. both
procedures lead to equivalent llk up to the Jacobian term).

## Candelon and Moura (2024)

The multi-country framework introduced in Candelon and Moura (2024) was
designed to enhance the tractability of large-scale ATSMs, providing a
deeper understanding of the intricate global economic mechanisms that
underlie yield curve fluctuations. This framework also reinforces the
statistical validity of inference and enhances the predictive
capabilities of these models. This novel setup, embodied by the *GVAR
multi* model class, is benchmarked against the findings of Jotikasthira,
Le, and Lundblad (2015), which are captured by the *JLL original* model
class. The paper showcases an empirical illustration involving China,
Brazil, Mexico, and Uruguay.

``` r
# A) Load database data
LoadData("CM_2024")

# B) GENERAL model inputs
ModelType <- "GVAR multi" # Options: "GVAR multi" or "JLL original".

Economies <- c("China", "Brazil", "Mexico", "Uruguay")
GlobalVar <- c("Gl_Eco_Act", "Gl_Inflation")
DomVar <- c("Eco_Act", "Inflation")
N <- 3

t0_sample <- "01-06-2004"
tF_sample <- "01-01-2020"

OutputLabel <- "CM_jfec"
DataFreq <- "Monthly"
Folder2Save <- NULL

StatQ <- FALSE

# B.1) SPECIFIC model inputs
#################################### GVAR-based models ##################################################
GVARlist <- list(
  VARXtype = "unconstrained", W_type = "Sample Mean", t_First_Wgvar = "2004",
  t_Last_Wgvar = "2019", DataConnectedness = TradeFlows
)
#################################### JLL-based models ###################################################
JLLlist <- list(DomUnit = "China")
###################################### BRW inputs  ######################################################
WishBC <- TRUE
BRWlist <- within(list(
  Cent_Measure = "Mean", gamma = 0.001, N_iter = 200, B = 50, checkBRW = TRUE,
  B_check = 1000, Eigen_rest = 1
), N_burn <- round(N_iter * 0.15))

# C) Decide on Settings for numerical outputs
WishFPremia <- TRUE
FPmatLim <- c(24, 36)

Horiz <- 25
DesiredGraphs <- c("GIRF", "GFEVD", "TermPremia")
WishGraphRiskFac <- FALSE
WishGraphYields <- TRUE
WishOrthoJLLgraphs <- TRUE

# D) Bootstrap settings
WishBootstrap <- FALSE #  Set it to TRUE, if bootstrap is desired
BootList <- list(methodBS = "bs", BlockLength = 4, ndraws = 1000, pctg = 95)

# E) Out-of-sample forecast
WishForecast <- TRUE
ForecastList <- list(ForHoriz = 12, t0Sample = 1, t0Forecast = 100, ForType = "Rolling")

#########################################################################################################
############################### NO NEED TO MAKE CHANGES FROM HERE #######################################
#########################################################################################################

# 2) Minor preliminary work: get the sets of factor labels and  a vector of common maturities
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(
  t0_sample, tF_sample, ModelType, Yields, GlobalMacro, DomMacro,
  FactorLabels, Economies, DataFreq, GVARlist, JLLlist, WishBC, BRWlist
)

# 4) Optimization of the ATSM (Point Estimates)
ModelParaList <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)

# 5) Numerical and graphical outputs
# a) Prepare list of inputs for graphs and numerical outputs
InputsForOutputs <- InputsForOutputs(
  ModelType, Horiz, DesiredGraphs, OutputLabel, StatQ, DataFreq,
  WishGraphYields, WishGraphRiskFac, WishOrthoJLLgraphs, WishFPremia,
  FPmatLim, WishBootstrap, BootList, WishForecast, ForecastList
)

# b) Fit, IRF, FEVD, GIRF, GFEVD, and Term Premia
NumericalOutputs <- NumOutputs(
  ModelType, ModelParaList, InputsForOutputs, FactorLabels,
  Economies, Folder2Save
)

# c) Confidence intervals (bootstrap analysis)
BootstrapAnalysis <- Bootstrap(
  ModelType, ModelParaList, NumericalOutputs, Economies, InputsForOutputs,
  FactorLabels, JLLlist, GVARlist, WishBC, BRWlist, Folder2Save
)

# 6) Out-of-sample forecasting
Forecasts <- ForecastYields(
  ModelType, ModelParaList, InputsForOutputs, FactorLabels, Economies,
  JLLlist, GVARlist, WishBC, BRWlist, Folder2Save
)
```

## Candelon and Moura (2023)

In this paper, Candelon and Moura (2023) delve into an exploration of
the underlying factors that shape the sovereign yield curves of Brazil,
India, Mexico, and Russia in the midst of the COVID$- 19$ pandemic
crisis. To comprehensively address the intricate web of global
macro-financial and particularly health-related interdependencies, the
study employs a modeling approach based on a *GVAR multi* type
framework. By delving into these aspects, the authors aim to provide a
nuanced understanding of the dynamics influencing sovereign yield curves
in these countries during the challenging circumstances of the pandemic.

``` r
# A) Load database data
LoadData("CM_2023")

# B) GENERAL model inputs
ModelType <- "GVAR multi"

Economies <- c("Brazil", "India", "Russia", "Mexico")
GlobalVar <- c("US_Output_growth", "China_Output_growth", "SP500")
DomVar <- c("Inflation", "Output_growth", "CDS", "COVID")
N <- 2

t0_sample <- "22-03-2020"
tF_sample <- "26-09-2021"

OutputLabel <- "CM_EM"
DataFreq <- "Weekly"
F2S <- NULL

StatQ <- FALSE

# B.1) SPECIFIC model inputs
#################################### GVAR-based models ##################################################
GVARlist <- list(
  VARXtype = "constrained: COVID", W_type = "Sample Mean", t_First_Wgvar = "2015",
  t_Last_Wgvar = "2020", DataConnectedness = TradeFlows_covid
)
###################################### BRW inputs  ######################################################
WishBC <- FALSE

# C) Decide on Settings for numerical outputs
WishFPremia <- TRUE
FPmatLim <- c(47, 48)

Horiz <- 12
DesiredGraphs <- c("GIRF", "GFEVD", "TermPremia")
WishGraphRiskFac <- FALSE
WishGraphYields <- TRUE
WishOrthoJLLgraphs <- FALSE

# D) Bootstrap settings
WishBootstrap <- TRUE #  YES: 1; No = 0.
BootList <- list(methodBS = "bs", BlockLength = 4, ndraws = 100, pctg = 95)

#########################################################################################################
############################### NO NEED TO MAKE CHANGES FROM HERE #######################################
#########################################################################################################

# 2) Minor preliminary work: get the sets of factor labels and  a vector of common maturities
FactorLabels <- LabFac(N, DomVar, GlobalVar, Economies, ModelType)

# 3) Prepare the inputs of the likelihood function
ATSMInputs <- InputsForOpt(
  t0_sample, tF_sample, ModelType, Yields_covid, GlobalMacro_covid, DomMacro_covid, FactorLabels,
  Economies, DataFreq, GVARlist
)

# 4) Optimization of the ATSM (Point Estimates)
ModelParaList <- Optimization(ATSMInputs, StatQ, DataFreq, FactorLabels, Economies, ModelType)

# 5) Numerical and graphical outputs
# a) Prepare list of inputs for graphs and numerical outputs
InputsForOutputs <- InputsForOutputs(
  ModelType, Horiz, DesiredGraphs, OutputLabel, StatQ, DataFreq,
  WishGraphYields, WishGraphRiskFac, WishOrthoJLLgraphs, WishFPremia,
  FPmatLim, WishBootstrap, BootList
)

# b) Fit, IRF, FEVD, GIRF, GFEVD, and Term Premia
NumericalOutputs <- NumOutputs(
  ModelType, ModelParaList, InputsForOutputs, FactorLabels,
  Economies, F2S
)

# c) Confidence intervals (bootstrap analysis)
BootstrapAnalysis <- Bootstrap(ModelType, ModelParaList, NumericalOutputs, Economies, InputsForOutputs,
  FactorLabels,
  JLLlist = NULL, GVARlist, WishBC, BRWlist, F2S
)
```

## References

Ang, Andrew, and Monika Piazzesi. 2003. “A No-Arbitrage Vector
Autoregression of Term Structure Dynamics with Macroeconomic and Latent
Variables.” *Journal of Monetary Economics* 50 (4): 745–87.

Bauer, Michael D, and Glenn D Rudebusch. 2017. “Resolving the Spanning
Puzzle in Macro-Finance Term Structure Models.” *Review of Finance* 21
(2): 511–53.

Candelon, Bertrand, and Rubens Moura. 2023. “Sovereign Yield Curves and
the COVID-19 in Emerging Markets.” *Economic Modelling*, 106453.
https://doi.org/<https://doi.org/10.1016/j.econmod.2023.106453>.

———. 2024. “A Multicountry Model of the Term Structures of Interest
Rates with a GVAR.” *Journal of Financial Econometrics* 22 (5): 1558–87.

Joslin, Scott, Marcel Priebsch, and Kenneth J. Singleton. 2014. “Risk
Premiums in Dynamic Term Structure Models with Unspanned Macro Risks.”
*Journal of Finance* 69 (3): 1197–1233.

Jotikasthira, Chotibhak, Anh Le, and Christian Lundblad. 2015. “Why Do
Term Structures in Different Currencies Co-Move?” *Journal of Financial
Economics* 115: 58–83.
